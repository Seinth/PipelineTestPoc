import org.apache.tools.ant.filters.ConcatFilter

apply plugin: 'groovy'

def orgSourceDir="${projectDir}/src/main/groovy"
def tmpSourceDir="${projectDir}/src/main/tmpgroovy"
def resSourceDir="${projectDir}/src/main/resources"


repositories {
  mavenCentral()
}

dependencies {
  compile 'org.codehaus.groovy:groovy-all:2.4.7'
  testCompile 'junit:junit:4.12'
  testCompile 'com.lesfurets:jenkins-pipeline-unit:1.1'
}

sourceSets {
    test {
        groovy {
            srcDirs= ['src/test/groovy']
        }
    }
}

test.doFirst {
  mkdir "${tmpSourceDir}"
  copy {
    from "${orgSourceDir}"
    into "${tmpSourceDir}"
    filter(ConcatFilter, prepend : file("${resSourceDir}/firstline"), append : file("${resSourceDir}/lastline"))
  }
}

test.doLast {
  delete "${tmpSourceDir}"
}
